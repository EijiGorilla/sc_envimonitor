"use strict";(self.webpackChunksc_envimonitor=self.webpackChunksc_envimonitor||[]).push([[4650],{94650:(e,r,a)=>{a.r(r),a.d(r,{fromUrl:()=>v});var t=a(9236),n=a(10064),l=a(35995),o=a(25899),s=a(84076),i=a(74368),u=a(37933),c=a(19610),y=a(41226);const d={FeatureLayer:!0,SceneLayer:!0};async function v(e){const{properties:r,url:n}=e,l=(0,t.Z)((0,t.Z)({},r),{},{url:n}),o=await w(n,null===r||void 0===r?void 0:r.customParameters),{Constructor:s,layerId:i,sourceJSON:u,parsedUrl:c,layers:y,tables:d}=o;if(y.length+d.length===0)return null!=i&&(l.layerId=i),null!=u&&(l.sourceJSON=u),new s(l);const v=new(0,(await Promise.resolve().then(a.bind(a,65069))).default)({title:c.title});return await async function(e,r,a){const t=r.sublayerConstructorProvider;for(const{id:l,serverUrl:o}of r.layers){var n;const s=f(r.sublayerInfos,l),i=p(o,l,s,null!==(n=s&&(null===t||void 0===t?void 0:t(s)))&&void 0!==n?n:r.Constructor,a);e.add(i)}if(r.tables.length){const t=await h("FeatureLayer");r.tables.forEach((n=>{let{id:l,serverUrl:o}=n;const s=p(o,l,f(r.tableInfos,l),t,a);e.tables.add(s)}))}}(v,o,l),v}function f(e,r){return e?e.find((e=>{let{id:a}=e;return a===r})):null}function p(e,r,a,n,l){const o=(0,t.Z)((0,t.Z)({},l),{},{layerId:r});return null!=e&&(o.url=e),null!=a&&(o.sourceJSON=a),"sublayerTitleMode"in n.prototype&&(o.sublayerTitleMode="service-name"),new n(o)}async function w(e,r){let a=(0,o.Qc)(e);if(null==a&&(a=await async function(e,r){var a,t;const n=await(0,y.T)(e,{customParameters:r});let s=null,i=null;const u=n.type;if("Feature Layer"===u||"Table"===u?(s="FeatureServer",i=null!==(a=n.id)&&void 0!==a?a:null):"indexedVector"===u?s="VectorTileServer":n.hasOwnProperty("mapName")?s="MapServer":n.hasOwnProperty("bandCount")&&n.hasOwnProperty("pixelSizeX")?s="ImageServer":n.hasOwnProperty("maxRecordCount")&&n.hasOwnProperty("allowGeometryUpdates")?s="FeatureServer":n.hasOwnProperty("streamUrls")?s="StreamServer":m(n)?(s="SceneServer",i=n.id):n.hasOwnProperty("layers")&&m(null===(t=n.layers)||void 0===t?void 0:t[0])&&(s="SceneServer"),!s)return null;const c=null!=i?(0,o.DR)(e):null;return{title:null!=c&&n.name||(0,l.vt)(e),serverType:s,sublayer:i,url:{path:null!=c?c.serviceUrl:(0,l.mN)(e).path}}}(e,r)),null==a)throw new n.Z("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:e});const{serverType:t,sublayer:c}=a;let v;const f={FeatureServer:"FeatureLayer",KnowledgeGraphServer:"KnowledgeGraphLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer",VideoServer:"VideoLayer"},p="FeatureServer"===t,w="SceneServer"===t,S={parsedUrl:a,Constructor:null,layerId:(p||w)&&null!==c&&void 0!==c?c:void 0,layers:[],tables:[]};switch(t){case"MapServer":if(null!=c){const{type:a}=await(0,y.T)(e,{customParameters:r});switch(v="FeatureLayer",a){case"Catalog Layer":v="CatalogLayer";break;case"Catalog Dynamic Group Layer":throw new n.Z("arcgis-layers:unsupported",'fromUrl() not supported for "'.concat(a,'" layers'))}}else v=await async function(e,r){return(await(0,y.T)(e,{customParameters:r})).tileInfo}(e,r)?"TileLayer":"MapImageLayer";break;case"ImageServer":{var b;const a=await(0,y.T)(e,{customParameters:r}),{tileInfo:t,cacheType:n}=a;v=t?"LERC"!==(null===t||void 0===t||null===(b=t.format)||void 0===b?void 0:b.toUpperCase())||n&&"elevation"!==n.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer";break}case"SceneServer":{const e=await(0,y.T)(a.url.path,{customParameters:r});if(v="SceneLayer",e){const r=null===e||void 0===e?void 0:e.layers;if("Voxel"===(null===e||void 0===e?void 0:e.layerType))v="VoxelLayer";else if(null!==r&&void 0!==r&&r.length){var I;const e=null===(I=r[0])||void 0===I?void 0:I.layerType;null!=e&&null!=u.fb[e]&&(v=u.fb[e])}}break}case"3DTilesServer":throw new n.Z("arcgis-layers:unsupported","fromUrl() not supported for 3DTiles layers");case"FeatureServer":if(v="FeatureLayer",null!=c){const a=await(0,y.T)(e,{customParameters:r});S.sourceJSON=a,v=(0,i.W)(a.type)}break;default:v=f[t]}if(d[v]&&null==c){var g;const a=await async function(e,r,a){var t,n;let l,o,u=!1;switch(r){case"FeatureServer":{const r=await(0,i.V)(e,{customParameters:a});u=!!r.layersJSON,l=r.layersJSON||r.serviceJSON;break}case"SceneServer":{const r=await async function(e,r){var a;const t=await(0,y.T)(e,{customParameters:r}),n=null===(a=t.layers)||void 0===a?void 0:a[0];if(!n)return{serviceInfo:t};try{const{serverUrl:a}=await(0,s.w)(e),n=await(0,y.T)(a,{customParameters:r}).catch((()=>null));return n&&(t.tables=n.tables),{serviceInfo:t,tableServerUrl:a}}catch(l){return{serviceInfo:t}}}(e,a);l=r.serviceInfo,o=r.tableServerUrl;break}default:l=await(0,y.T)(e,{customParameters:a})}const c=null===(t=l)||void 0===t?void 0:t.layers,d=null===(n=l)||void 0===n?void 0:n.tables;return{layers:(null===c||void 0===c?void 0:c.map((e=>({id:e.id}))).reverse())||[],tables:(null===d||void 0===d?void 0:d.map((e=>({serverUrl:o,id:e.id}))).reverse())||[],layerInfos:u?c:[],tableInfos:u?d:[]}}(e,t,r);if(p&&(S.sublayerInfos=a.layerInfos,S.tableInfos=a.tableInfos),1!==a.layers.length+a.tables.length)S.layers=a.layers,S.tables=a.tables,p&&(null===(g=a.layerInfos)||void 0===g?void 0:g.length)&&(S.sublayerConstructorProvider=await async function(e){if(!e.length)return;const r=new Set,a=[];for(const{type:l}of e)r.has(l)||(r.add(l),a.push(h((0,i.W)(l))));const t=await Promise.all(a),n=new Map;return Array.from(r).forEach(((e,r)=>{n.set(e,t[r])})),e=>n.get(e.type)}(a.layerInfos));else if(p||w){var L,T,P,U,Z,C;const e=null!==(L=null===(T=a.layerInfos)||void 0===T?void 0:T[0])&&void 0!==L?L:null===(P=a.tableInfos)||void 0===P?void 0:P[0];if(S.layerId=null!==(U=null===(Z=a.layers[0])||void 0===Z?void 0:Z.id)&&void 0!==U?U:null===(C=a.tables[0])||void 0===C?void 0:C.id,S.sourceJSON=e,p){const r=null===e||void 0===e?void 0:e.type;v=(0,i.W)(r)}}}return S.Constructor=await h(v),S}function m(e){return null!=e&&e.hasOwnProperty("store")&&e.hasOwnProperty("id")&&"number"==typeof e.id}async function h(e){return(0,c.T[e])()}},84076:(e,r,a)=>{a.d(r,{w:()=>y});var t=a(9236),n=a(19545),l=a(76200),o=a(10064),s=a(66978),i=a(25899),u=a(7575),c=a(98995);async function y(e,r){var a,y;const f=(0,i.Qc)(e);if(!f)throw new o.Z("invalid-url","Invalid scene service url");const p=(0,t.Z)((0,t.Z)({},r),{},{sceneServerUrl:f.url.path,layerId:null!==(a=f.sublayer)&&void 0!==a?a:void 0});if(null!==(y=p.sceneLayerItem)&&void 0!==y||(p.sceneLayerItem=await async function(e){const r=(await d(e)).serviceItemId;if(!r)return null;const a=new c.default({id:r,apiKey:e.apiKey}),t=await async function(e){const r=null===n.id||void 0===n.id?void 0:n.id.findServerInfo(e.sceneServerUrl);if(null!==r&&void 0!==r&&r.owningSystemUrl)return r.owningSystemUrl;const a=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const r=(await(0,l.Z)(a,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(r)return r}catch(w){(0,s.r9)(w)}return null}(e);null!=t&&(a.portal=new u.Z({url:t}));try{return await a.load({signal:e.signal})}catch(m){return(0,s.r9)(m),null}}(p)),null==p.sceneLayerItem)return v(p.sceneServerUrl.replace("/SceneServer","/FeatureServer"),p);const w=await async function(e){let{sceneLayerItem:r,signal:a}=e;if(!r)return null;try{const e=(await r.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:a})).find((e=>"Feature Service"===e.type))||null;if(!e)return null;const t=new c.default({portal:e.portal,id:e.id});return await t.load(),t}catch(t){return(0,s.r9)(t),null}}(p);if(null===w||void 0===w||!w.url)throw new o.Z("related-service-not-found","Could not find feature service through portal item relationship");p.featureServiceItem=w;const m=await v(w.url,p);return m.portalItem=w,m}async function d(e){if(e.rootDocument)return e.rootDocument;const r={query:(0,t.Z)((0,t.Z)({f:"json"},e.customParameters),{},{token:e.apiKey}),responseType:"json",signal:e.signal};try{const a=await(0,l.Z)(e.sceneServerUrl,r);e.rootDocument=a.data}catch(a){e.rootDocument={}}return e.rootDocument}async function v(e,r){var a,n,s;const u=(0,i.Qc)(e);if(!u)throw new o.Z("invalid-feature-service-url","Invalid feature service url");const c=u.url.path,y=r.layerId;if(null==y)return{serverUrl:c};const v=d(r),f=r.featureServiceItem?await r.featureServiceItem.fetchData("json"):null,p=null===(a=(null===f||void 0===f||null===(n=f.layers)||void 0===n?void 0:n[0])||(null===f||void 0===f||null===(s=f.tables)||void 0===s?void 0:s[0]))||void 0===a?void 0:a.customParameters,w=e=>{const a={query:(0,t.Z)({f:"json"},p),responseType:"json",authMode:e,signal:r.signal};return(0,l.Z)(c,a)},m=w("anonymous").catch((()=>w("no-prompt"))),[h,S]=await Promise.all([m,v]),b=null===S||void 0===S?void 0:S.layers,I=h.data&&h.data.layers;if(!Array.isArray(I))throw new Error("expected layers array");if(Array.isArray(b)){for(let t=0;t<Math.min(b.length,I.length);t++)if(b[t].id===y)return{serverUrl:c,layerId:I[t].id}}else if(null!=y&&y<I.length)return{serverUrl:c,layerId:I[y].id};throw new Error("could not find matching associated sublayer")}},74368:(e,r,a)=>{a.d(r,{V:()=>s,W:()=>f});var t=a(44925),n=a(41226);const l=["loadContext"],o=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function s(e,r){var a;const o=r||{},{loadContext:s}=o,i=(0,t.Z)(o,l),u=s?await s.fetchServiceMetadata(e,i):await(0,n.T)(e,i);v(u),c(u);const y={serviceJSON:u};if((null!==(a=u.currentVersion)&&void 0!==a?a:0)<10.5)return y;const d="".concat(e,"/layers"),f=s?await s.fetchServiceMetadata(d,i):await(0,n.T)(d,i);return v(f),c(f),y.layersJSON={layers:f.layers,tables:f.tables},y}function i(e){const{type:r}=e;return!!r&&o.has(r)}function u(e){return"Table"===e.type}function c(e){var r,a;e.layers=null===(r=e.layers)||void 0===r?void 0:r.filter(i),e.tables=null===(a=e.tables)||void 0===a?void 0:a.filter(u)}function y(e){e.type||(e.type="Feature Layer")}function d(e){e.type||(e.type="Table")}function v(e){var r,a;null!==(r=e.layers)&&void 0!==r&&r.forEach(y),null===(a=e.tables)||void 0===a||a.forEach(d)}function f(e){switch(e){case"Feature Layer":case"Table":return"FeatureLayer";case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},41226:(e,r,a)=>{a.d(r,{T:()=>l});var t=a(9236),n=a(76200);async function l(e,r){const{data:a}=await(0,n.Z)(e,{responseType:"json",query:(0,t.Z)((0,t.Z)({f:"json"},null===r||void 0===r?void 0:r.customParameters),{},{token:null===r||void 0===r?void 0:r.apiKey})});return a}}}]);
//# sourceMappingURL=4650.dcd5343d.chunk.js.map