"use strict";(self.webpackChunksc_envimonitor=self.webpackChunksc_envimonitor||[]).push([[2894],{47741:(e,t,n)=>{n.d(t,{F:()=>c,a:()=>d,b:()=>h});var r,i=n(30168),o=n(24967),s=n(99339),l=n(98634),a=n(64201),u=n(19253);class c extends l.K{}function h(){const e=new a.kG;return e.include(o.k),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new u.A("colorTexture",(e=>e.color)),new u.A("focusArea",(e=>e.focusArea)),new s._("focusAreaEffectMode",(e=>{var t;return null!==(t=e.effect)&&void 0!==t?t:1}))).main.add((0,l.H)(r||(r=(0,i.Z)(["float mask = texture( focusArea, uv, 0.0 ).r;\nvec4 color = texture( colorTexture, uv, 0.0 );\nvec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);\nif (focusAreaEffectMode == 1) {\nfragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;\n} else {\nfragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);\n}"])))),e}const d=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:c,build:h},Symbol.toStringTag,{value:"Module"}))},68908:(e,t,n)=>{n.d(t,{F:()=>f,a:()=>x,b:()=>v});var r,i,o=n(30168),s=n(29134),l=n(7025),a=n(12400),u=n(98634),c=n(8654),h=n(64201),d=n(4760);class f extends u.K{constructor(){super(...arguments),this.origin=a.AG}}function v(){const e=new h.kG;return e.attributes.add(d.T.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new c.g("proj",((e,t)=>t.camera.projectionMatrix)),new c.g("view",((e,t)=>(0,s.Iu)(p,t.camera.viewMatrix,e.origin)))).main.add((0,u.H)(r||(r=(0,o.Z)(["gl_Position = proj * view * vec4(position, 1.0);"])))),e.fragment.main.add((0,u.H)(i||(i=(0,o.Z)(["fragColor = vec4(1., 0., 0., 1.);"])))),e}const p=(0,l.Ue)(),x=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskPassParameters:f,build:v},Symbol.toStringTag,{value:"Module"}))},79347:(e,t,n)=>{function r(e,t,n){n=n||2;var r,o,l,a,u,c,d,f=t&&t.length,v=f?t[0]*n:e.length,p=i(e,0,v,n,!0),x=[];if(!p||p.next===p.prev)return x;if(f&&(p=h(e,t,p,n)),e.length>80*n){r=l=e[0],o=a=e[1];for(var y=n;y<v;y+=n)(u=e[y])<r&&(r=u),(c=e[y+1])<o&&(o=c),u>l&&(l=u),c>a&&(a=c);d=0!==(d=Math.max(l-r,a-o))?1/d:0}return s(p,x,n,r,o,d),x}function i(e,t,n,r,i){var o,s;if(i===P(e,t,n,r)>0)for(o=t;o<n;o+=r)s=N(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=N(o,e[o],e[o+1],s);if(s&&m(s,s.next)){var l=s.next;T(s),s=l}return s}function o(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{var i=r.prev;if(T(r),(r=t=i)===r.next)break;n=!0}}while(n||r!==t);return t}function s(e,t,n,r,i,h,d){if(e){!d&&h&&x(e,r,i,h);for(var f,v,p=e;e.prev!==e.next;)if(f=e.prev,v=e.next,h?a(e,r,i,h):l(e))t.push(f.i/n),t.push(e.i/n),t.push(v.i/n),T(e),e=v.next,p=v.next;else if((e=v)===p){d?1===d?s(e=u(o(e),t,n),t,n,r,i,h,2):2===d&&c(e,t,n,r,i,h):s(o(e),t,n,r,i,h,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(w(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(_(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&w(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,n,r){var i=e.prev,o=e,s=e.next;if(w(i,o,s)>=0)return!1;for(var l=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,a=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,u=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,c=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=y(l,a,t,n,r),d=y(u,c,t,n,r),f=e.prevZ,v=e.nextZ;f&&f.z>=h&&v&&v.z<=d;){if(f!==e.prev&&f!==e.next&&_(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,v!==e.prev&&v!==e.next&&_(i.x,i.y,o.x,o.y,s.x,s.y,v.x,v.y)&&w(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&_(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=d;){if(v!==e.prev&&v!==e.next&&_(i.x,i.y,o.x,o.y,s.x,s.y,v.x,v.y)&&w(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function u(e,t,n){var r=e;do{var i=r.prev,s=r.next.next;!m(i,s)&&A(i,r,r.next,s)&&S(i,s)&&S(s,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(s.i/n),T(r),T(r.next),r=e=s),r=r.next}while(r!==e);return o(r)}function c(e,t,n,r,i,l){var a=e;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&b(a,u)){var c=R(a,u);return a=o(a,a.next),c=o(c,c.next),s(a,t,n,r,i,l),void s(c,t,n,r,i,l)}u=u.next}a=a.next}while(a!==e)}function h(e,t,n,r){var s,l,a,u=[];for(s=0,l=t.length;s<l;s++)(a=i(e,t[s]*r,s<l-1?t[s+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),u.push(g(a));for(u.sort(d),s=0;s<u.length;s++)n=o(n=v(u[s],n),n.next);return n}function d(e,t){return e.x-t.x}function f(e){if(e.next.prev===e)return e;let t=e;for(;;){const n=t.next;if(n.prev===t||n===t||n===e)break;t=n}return t}function v(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var l=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(l<=i&&l>s){if(s=l,l===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===s)return n;var a,u=n,c=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&_(o<h?i:s,o,c,h,o<h?s:i,o,r.x,r.y)&&(a=Math.abs(o-r.y)/(i-r.x),S(r,e)&&(a<d||a===d&&(r.x>n.x||r.x===n.x&&p(n,r)))&&(n=r,d=a)),r=r.next}while(r!==u);return n}(e,t);if(!n)return t;var r=R(n,e),i=o(n,n.next);let s=f(r);return o(s,s.next),i=f(i),f(t===n?i:t)}function p(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function x(e,t,n,r){var i=e;do{null===i.z&&(i.z=y(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,s,l,a,u=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,l=0,t=0;t<u&&(l++,r=r.nextZ);t++);for(a=u;l>0||a>0&&r;)0!==l&&(0===a||!r||n.z<=r.z)?(i=n,n=n.nextZ,l--):(i=r,r=r.nextZ,a--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(s>1)}(i)}function y(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function _(e,t,n,r,i,o,s,l){return(i-s)*(t-l)-(e-s)*(o-l)>=0&&(e-s)*(r-l)-(n-s)*(t-l)>=0&&(n-s)*(o-l)-(i-s)*(r-l)>=0}function b(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&A(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(S(e,t)&&S(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||m(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,n,r){var i=E(w(e,t,n)),o=E(w(e,t,r)),s=E(w(n,r,e)),l=E(w(n,r,t));return i!==o&&s!==l||!(0!==i||!C(e,n,t))||!(0!==o||!C(e,r,t))||!(0!==s||!C(n,e,r))||!(0!==l||!C(n,t,r))}function C(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function E(e){return e>0?1:e<0?-1:0}function S(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function R(e,t){var n=new Z(e.i,e.x,e.y),r=new Z(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function N(e,t,n,r){var i=new Z(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Z(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function P(e,t,n,r){for(var i=0,o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}n.d(t,{e:()=>r}),r.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,s=Math.abs(P(e,0,o,n));if(i)for(var l=0,a=t.length;l<a;l++){var u=t[l]*n,c=l<a-1?t[l+1]*n:e.length;s-=Math.abs(P(e,u,c,n))}var h=0;for(l=0;l<r.length;l+=3){var d=r[l]*n,f=r[l+1]*n,v=r[l+2]*n;h+=Math.abs((e[d]-e[v])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[v+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},r.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[i][o][s]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},35888:(e,t,n)=>{n.d(t,{d:()=>o});var r=n(16889),i=n(39406);function o(e,t,n){var o;const c=Array.isArray(e),h=c?e.length/t:e.byteLength/(4*t),d=c?e:new Uint32Array(e,0,h*t),f=null!==(o=null===n||void 0===n?void 0:n.minReduction)&&void 0!==o?o:0,v=(null===n||void 0===n?void 0:n.originalIndices)||null,p=v?v.length:0,x=(null===n||void 0===n?void 0:n.componentOffsets)||null;let y=0;if(x)for(let r=0;r<x.length-1;r++){const e=x[r+1]-x[r];e>y&&(y=e)}else y=h;const g=Math.floor(1.1*y)+1;(null==u||u.length<2*g)&&(u=new Uint32Array((0,r.Sf)(2*g)));for(let r=0;r<2*g;r++)u[r]=0;let _=0;const b=!!x&&!!v,w=b?p:h;let m=(0,i.$z)(h);const A=new Uint32Array(p),C=1.96;let E=0!==f?Math.ceil(4*C*C/(f*f)*f*(1-f)):w,S=1,R=x?x[1]:w;for(let r=0;r<w;r++){if(r===E){const e=1-_/r;if(e+C*Math.sqrt(e*(1-e)/r)<f)return null;E*=2}if(r===R){for(let e=0;e<2*g;e++)u[e]=0;if(v)for(let e=x[S-1];e<x[S];e++)A[e]=m[v[e]];R=x[++S]}const e=b?v[r]:r,n=e*t,i=a(d,n,t);let o=i%g,l=_;for(;0!==u[2*o+1];){if(u[2*o]===i){const e=u[2*o+1]-1;if(s(d,n,e*t,t)){l=m[e];break}}o++,o>=g&&(o-=g)}l===_&&(u[2*o]=i,u[2*o+1]=e+1,_++),m[e]=l}if(0!==f&&1-_/h<f)return null;if(b){for(let e=x[S-1];e<A.length;e++)A[e]=m[v[e]];m=(0,i.mi)(A)}const N=c?new Array(_):new Uint32Array(_*t);_=0;for(let r=0;r<w;r++)m[r]===_&&(l(d,(b?v[r]:r)*t,N,_*t,t),_++);if(v&&!b){const e=new Uint32Array(p);for(let t=0;t<e.length;t++)e[t]=m[v[t]];m=(0,i.mi)(e)}return{buffer:Array.isArray(N)?N:N.buffer,indices:m,uniqueCount:_}}function s(e,t,n,r){for(let i=0;i<r;i++)if(e[t+i]!==e[n+i])return!1;return!0}function l(e,t,n,r,i){for(let o=0;o<i;o++)n[r+o]=e[t+o]}function a(e,t,n){let r=0;for(let i=0;i<n;i++)r=e[t+i]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let u=null},26844:(e,t,n)=>{n.d(t,{i:()=>a});var r=n(16889),i=n(68860),o=n(32035),s=n(14320),l=n(55652);function a(e,t,n){const a=function(e,t,n,r){const s=(e=>!Array.isArray(e[0]))(t)?(e,n)=>t[3*e+n]:(e,n)=>t[e][n],a=r?(0,i.c9)(r)/(0,i._R)(r):1;return(0,l.zu)(e,((e,t)=>(0,o.i)(e,s(t,0)*a,s(t,1)*a,s(t,2))),n)}(u,e,t,n)?(0,l.st)(u):[0,0,1];return Math.abs(a[2])>Math.cos((0,r.Vl)(80))?s.R.Z:Math.abs(a[1])>Math.abs(a[0])?s.R.Y:s.R.X}const u=(0,l.Ue)()},91320:(e,t,n)=>{n.d(t,{Ni:()=>f,ZI:()=>r,bT:()=>d});var r,i,o=n(79347),s=n(14320),l=n(69662),a=n(86372),u=n(39406),c=n(26844),h=n(35888);function d(e){const t=f(e.rings,e.hasZ,r.CCW_IS_HOLE,e.spatialReference),n=new Array;let i=0,s=0;for(const r of t.polygons){const e=r.count,l=r.index,c=(0,a.Rq)(t.position,3*l,3*e),h=r.holeIndices.map((e=>e-l)),d=(0,u.mi)((0,o.e)(c,h,3));n.push({position:c,faces:d}),i+=c.length,s+=d.length}const l=function(e,t,n){if(1===e.length)return e[0];const r=(0,a.bg)(t),i=new Array(n);let o=0,s=0,l=0;for(const a of e){for(let e=0;e<a.position.length;e++)r[o++]=a.position[e];for(const e of a.faces)i[s++]=e+l;l=o/3}return{position:r,faces:(0,u.mi)(i)}}(n,i,s),c=Array.isArray(l.position)?(0,h.d)(l.position,3,{originalIndices:l.faces}):(0,h.d)(l.position.buffer,6,{originalIndices:l.faces});return l.position=(0,a.QZ)(new Float64Array(c.buffer)),l.faces=c.indices,l}function f(e,t,n,i){const o=e.length,s=new Array(o),l=new Array(o),u=new Array(o);let c=0;for(let r=0;r<o;++r)c+=e[r].length;let h=0,d=0,f=0;const x=(0,a.bg)(3*c);let y=0;for(let a=o-1;a>=0;a--){const c=e[a],g=n===r.CCW_IS_HOLE&&p(c,t,i);if(g&&1!==o)s[h++]=c;else{let e=c.length;for(let t=0;t<h;++t)e+=s[t].length;const n={index:y,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};n.pathLengths[0]=c.length,c.length>0&&(u[f++]={index:y,count:c.length}),y=g?v(c,c.length-1,-1,x,y,c.length,t):v(c,0,1,x,y,c.length,t);for(let r=0;r<h;++r){const e=s[r];n.holeIndices[r]=y,n.pathLengths[r+1]=e.length,e.length>0&&(u[f++]={index:y,count:e.length}),y=v(e,0,1,x,y,e.length,t)}h=0,n.count>0&&(l[d++]=n)}}for(let r=0;r<h;++r){const e=s[r];e.length>0&&(u[f++]={index:y,count:e.length}),y=v(e,0,1,x,y,e.length,t)}return l.length=d,u.length=f,{position:x,polygons:l,outlines:u}}function v(e,t,n,r,i,o,s){i*=3;for(let l=0;l<o;++l){const o=e[t];r[i++]=o[0],r[i++]=o[1],r[i++]=s&&o[2]?o[2]:0,t+=n}return i/3}function p(e,t,n){if(!t)return!(0,l.bu)(e);const r=e.length-1;switch((0,c.i)(e,r,n)){case s.R.X:return!(0,l.bu)(e,s.R.Y,s.R.Z);case s.R.Y:return!(0,l.bu)(e,s.R.X,s.R.Z);case s.R.Z:return!(0,l.bu)(e,s.R.X,s.R.Y)}}(i=r||(r={}))[i.NONE=0]="NONE",i[i.CCW_IS_HOLE=1]="CCW_IS_HOLE"},15380:(e,t,n)=>{n.r(t),n.d(t,{default:()=>V});var r=n(27366),i=n(92026),o=n(94172),s=n(49861),l=n(69912),a=n(79347),u=n(7025),c=n(32035),h=n(12400),d=n(37998),f=n(86372),v=n(39406),p=n(11186),x=n(50951),y=n(42069),g=n(78935),_=n(4714),b=n(96387),w=n(27689),m=(n(93169),n(32718),n(84936),n(18020)),A=n(31239),C=n(82144),E=n(78914),S=n(47741),R=n(36207);class N extends E.A{constructor(e,t,r){super(e,t,new C.J(S.a,(()=>n.e(1140).then(n.bind(n,91140)))),r)}initializePipeline(){return(0,R.sm)({colorWrite:R.gf})}}var T=n(68908),Z=n(8548);class P extends E.A{constructor(e,t,r){super(e,t,new C.J(T.a,(()=>n.e(7878).then(n.bind(n,37878)))),r)}initializePipeline(){return(0,R.sm)({colorWrite:R.gf,depthTest:{func:Z.wb.LEQUAL}})}}var I=n(7566),M=n(53641),O=n(80658),H=n(44070);let L=class extends A.Z{constructor(e){super(e),this.consumes={required:["final-color"]},this.produces="final-color",this.focusAreaGeometries=new Array,this._vaos=Array(),this._count=new Array,this._origins=new Array,this._colorParameters=new S.F,this._maskParameters=new T.F,e.techniques.precompile(P),e.techniques.precompile(N)}initialize(){this.setExtrudedVolume()}destroy(){this._vaos.forEach((e=>e.dispose())),this._vaos=[],this._count=[],this._origins=[]}render(e){const t=this.techniques.acquire(P),n=this.techniques.acquire(N),r=this.bindParameters,i=e.find((e=>{let{name:t}=e;return"final-color"===t})),o=null===i||void 0===i?void 0:i.getTexture(),s=r.camera,l=s.fullViewport[2],a=s.fullViewport[3],u=this.fboCache.acquire(l,a,"focusArea",m.q.RGBA),c=this.fboCache.acquire(l,a,this.produces);if(!t.compiled||!n.compiled||!this._vaos||this.effect===F.NONE)return this.requestRender(),t.release(),n.release(),c.release(),u.release(),i;const h=this.renderingContext;u.attachDepth(i.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),h.bindFramebuffer(u.fbo),h.clear(Z.Hf.COLOR|Z.Hf.STENCIL),h.setViewport(0,0,l,a),h.gl.clearStencil(0),h.gl.clear(h.gl.STENCIL_BUFFER_BIT),h.setClearStencil(0);for(let d=0;d<this._vaos.length;d++){const e=this._vaos[d],n=this._count[d];e&&(this._maskParameters.origin=this._origins[d],h.bindTechnique(t,r,this._maskParameters),h.setFaceCullingEnabled(!1),h.setStencilTestEnabled(!0),h.setStencilWriteMask(255),h.setStencilFunction(Z.wb.ALWAYS,0,255),h.setStencilOpSeparate(Z.LR.FRONT,Z.xS.KEEP,Z.xS.INCR_WRAP,Z.xS.KEEP),h.setStencilOpSeparate(Z.LR.BACK,Z.xS.KEEP,Z.xS.DECR_WRAP,Z.xS.KEEP),h.setDepthWriteEnabled(!1),h.setColorMask(!1,!1,!1,!1),h.bindVAO(e),h.drawArrays(Z.MX.TRIANGLES,0,n),h.setFaceCullingEnabled(!1),h.setDepthTestEnabled(!1),h.setStencilFunction(Z.wb.NOTEQUAL,0,255),h.setStencilWriteMask(0),h.setColorMask(!0,!0,!0,!0),h.drawArrays(Z.MX.TRIANGLES,0,n))}return t.release(),h.gl.clear(h.gl.STENCIL_BUFFER_BIT),h.bindFramebuffer(c.fbo),this._colorParameters.color=o,this._colorParameters.focusArea=u.getTexture(),this._colorParameters.effect=this.effect,h.bindTechnique(n,r,this._colorParameters),h.screen.draw(),u.release(),n.release(),c.attachDepth(i.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),c}setExtrudedVolume(){const e=this.focusAreaGeometries;this._vaos=[],this._count=[],this._origins=[];for(let n=0;n<e.length;n++){var t;const r=e[n],i=new Array,o=r.indicesBottom;this._origins.push(r.origin);for(let e=0;e<o.length;e++)i.push(r.positions[3*(o[e]-1)]),i.push(r.positions[3*(o[e]-1)+1]),i.push(r.positions[3*(o[e]-1)+2]);const s=r.indicesExtruded;for(let e=0;e<s.length;e++)i.push(r.positions[3*s[e]]),i.push(r.positions[3*s[e]+1]),i.push(r.positions[3*s[e]+2]);const l=new Float32Array(i),a=new O.U(this.renderingContext,I.i,new Map([["geometry",M.ap]]),new Map([["geometry",H.f.createVertex(this.renderingContext,Z.l1.STATIC_DRAW,l)]]));null!==(t=this._vaos)&&void 0!==t&&t.push(a),this._count.push(o.length+s.length)}}};(0,r._)([(0,s.Cb)()],L.prototype,"consumes",void 0),(0,r._)([(0,s.Cb)()],L.prototype,"produces",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],L.prototype,"techniques",void 0),(0,r._)([(0,s.Cb)()],L.prototype,"focusAreaGeometries",void 0),(0,r._)([(0,s.Cb)()],L.prototype,"effect",void 0),L=(0,r._)([(0,l.j)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaRenderNode")],L);class k{constructor(e,t,n,r,i){this.positions=e,this.indicesBottom=t,this.indicesExtruded=n,this.height=r,this.origin=i}}var F,q;(q=F||(F={}))[q.NONE=0]="NONE",q[q.BRIGHT=1]="BRIGHT",q[q.DARK=2]="DARK";const z={none:F.NONE,bright:F.BRIGHT,dark:F.DARK};var U=n(67581);let G=class extends((0,y.A)(U.Z)){constructor(){super(...arguments),this.type="focusArea-3d",this._elevationContext=new g.o,this._geometries=new Array}initialize(){this.addHandles([(0,o.YP)((()=>this.layer.geometries),((e,t)=>{t=e,this._extrudePolygons(t),this._setFocusAreaRenderNode()}),o.tX),(0,o.YP)((()=>this.layer.tmpEffect),((e,t)=>{t=e,this._renderNode&&t&&(this._renderNode.effect=z[t])}),o.tX),(0,o.YP)((()=>this.layer.visible),((e,t)=>{var n,r;e?null!==(n=this._renderNode)&&void 0!==n||(this._renderNode=new L({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:z[null!==(r=this.layer.tmpEffect)&&void 0!==r?r:"none"]})):this._renderNode=(0,i.SC)(this._renderNode)}),o.tX)])}destroy(){this._renderNode=(0,i.SC)(this._renderNode),this._geometries=[]}_extrudePolygons(e){this._geometries=[];for(const t of e){const e=(0,u.Ue)(),n=(0,h.Ue)(),r=this.view.renderCoordsHelper.viewingMode===x.JY.Global;r||this.view.renderCoordsHelper.worldUpAtPosition(null,n);const i=(0,b.zE)(t);if(null==i)return;(0,d.B)(t.spatialReference,[i.x,i.y,0],e,this.view.renderCoordsHelper.spatialReference);const o=(0,c.n)(D,[e[12]-0*n[0],e[13]-0*n[1],e[14]-0*n[2]]),s=(0,u.Ue)();s[12]=-e[12],s[13]=-e[13],s[14]=-e[14];const l=(0,w.VP)(t,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:y,mapPositions:g,position:m}=l;for(const t of y){const i=t.count,l=(0,a.e)(t.mapPositions,t.holeIndices,3);if(0===l.length)continue;const u=l.length,c=6*i,h=(0,v.$z)(c+u),d=(0,v.$z)(u),x=(0,f.bg)(3*c),y=(0,f.bg)(3*c),b=(0,f.bg)(3*c),w=(0,f.bg)(c);(0,_.A)(m,g,l,t,x,b,y,w,h,d,1e4,n,r),(0,p.t)(x,x,s);const A=new k(x,d,h,1e4,[e[12]+0*o[0],e[13]+0*o[1],e[14]+0*o[2]]);this._geometries.push(A)}}}_setFocusAreaRenderNode(){var e;this._renderNode?(this._renderNode.focusAreaGeometries=this._geometries,this._renderNode.setExtrudedVolume()):this._renderNode=new L({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:z[null!==(e=this.layer.tmpEffect)&&void 0!==e?e:"none"]})}};(0,r._)([(0,s.Cb)()],G.prototype,"type",void 0),(0,r._)([(0,s.Cb)()],G.prototype,"layer",void 0),G=(0,r._)([(0,l.j)("esri.views.3d.layers.FocusAreaLayerView3D")],G);const D=(0,h.Ue)(),V=G},42069:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(27366),i=n(42537),o=n(66978),s=n(94172),l=n(49861),a=(n(93169),n(32718),n(84936),n(69912)),u=n(5354);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,u.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,i.kB)((()=>e.abort()))),await(0,s.N1)((()=>{var e;return null===(e=this.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady}),t),(0,o.k_)(t);const n=(0,u.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(n)throw n}};return(0,r._)([(0,l.Cb)()],t.prototype,"view",void 0),(0,r._)([(0,l.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,r._)([(0,a.j)("esri.views.3d.layers.LayerView3D")],t),t}},67581:(e,t,n)=>{n.d(t,{Z:()=>p});var r=n(27366),i=n(7138),o=n(91505),s=n(79056),l=n(32718),a=n(92026),u=n(67426),c=n(49861),h=(n(93169),n(84936),n(69912)),d=n(46634),f=n(69787);let v=class extends((0,s.IG)((0,u.v)(o.Z.EventedMixin(i.Z)))){constructor(e){super(e),this._updatingHandles=new d.R,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){var t;const n=this.layer&&this.layer.id||"no id",r=(null===(t=this.layer)||void 0===t?void 0:t.title)||"no title";l.Z.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(n,"')"),e)}}))}destroy(){this._updatingHandles=(0,a.SC)(this._updatingHandles)}get fullOpacity(){var e,t,n,r;return(null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1)*(null!==(n=null===(r=this.parent)||void 0===r?void 0:r.fullOpacity)&&void 0!==n?n:1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}get updating(){var e;return!((null===(e=this._updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){var e;const t=this.view.timeExtent,n=null===(e=this.layer)||void 0===e?void 0:e.visibilityTimeExtent;return!t||!n||!t.intersection(n).isEmpty}canResume(){var e,t,n;const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(n=this.view)||void 0===n?void 0:n.ready)&&(0,f.Cy)(r)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){var e,t;const n=null!==(e=this.parent)&&void 0!==e&&e.suspended?this.parent.suspendInfo:{};null!==(t=this.view)&&void 0!==t&&t.ready||(n.viewNotReady=!0),this.layer&&this.layer.loaded||(n.layerNotLoaded=!0);const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,f.Cy)(r)&&this.visibleAtCurrentScale||(n.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(n.outsideVisibilityTimeExtent=!0),this.visible||(n.layerInvisible=!0),n}isUpdating(){return!1}};(0,r._)([(0,c.Cb)()],v.prototype,"view",void 0),(0,r._)([(0,c.Cb)()],v.prototype,"fullOpacity",null),(0,r._)([(0,c.Cb)()],v.prototype,"layer",void 0),(0,r._)([(0,c.Cb)()],v.prototype,"parent",void 0),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"suspended",null),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"suspendInfo",null),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"legendEnabled",null),(0,r._)([(0,c.Cb)({type:Boolean,readOnly:!0})],v.prototype,"updating",null),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"updatingProgress",null),(0,r._)([(0,c.Cb)()],v.prototype,"updateSuspended",null),(0,r._)([(0,c.Cb)()],v.prototype,"visible",null),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"visibleAtCurrentScale",null),(0,r._)([(0,c.Cb)({readOnly:!0})],v.prototype,"visibleAtCurrentTimeExtent",null),v=(0,r._)([(0,h.j)("esri.views.layers.LayerView")],v);const p=v}}]);
//# sourceMappingURL=2894.97a9dfd9.chunk.js.map